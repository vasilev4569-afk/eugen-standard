{{ define "main" }}
<main class="container">
  <article>
    <header>
      <h1>{{ .Title }}</h1>

      {{/* Capacity switcher (robust) */}}
      {{- $dir := strings.TrimSuffix "/" .File.Dir -}}
      {{- $cap := path.Base $dir -}}
      {{- $seriesDir := path.Dir $dir -}}
      {{- $base := printf "/%s/" $seriesDir | relLangURL -}}

      {{- $isCapPage := or (eq $cap "500gb") (eq $cap "1tb") (eq $cap "2tb") -}}
      {{- if $isCapPage -}}
        <nav class="cap-switch" aria-label="Capacity switch">
          <a class="cap-btn {{ if eq $cap "500gb" }}is-active{{ end }}" href="{{ $base }}500gb/">500GB</a>
          <a class="cap-btn {{ if eq $cap "1tb" }}is-active{{ end }}" href="{{ $base }}1tb/">1TB</a>
          <a class="cap-btn {{ if eq $cap "2tb" }}is-active{{ end }}" href="{{ $base }}2tb/">2TB</a>
        </nav>
      {{- end -}}

      {{/* AUTO PHOTO (bundle resources)
           1) match by capacity name (1tb.* / 500gb.* / 2tb.*)
           2) fallback: first image in bundle
      */}}
      {{- $img := .Resources.GetMatch (printf "%s.*" $cap) -}}
      {{- if not $img -}}
        {{- $imgs := .Resources.ByType "image" -}}
        {{- if gt (len $imgs) 0 -}}
          {{- $img = index (sort $imgs "Name" "asc") 0 -}}
        {{- end -}}
      {{- end -}}

      {{- if $img -}}
        <figure class="unit-photo" style="margin: 16px 0 10px; max-width: 720px;">
          <img
            src="{{ $img.RelPermalink }}"
            alt="{{ .Title }} – test unit photo"
            loading="lazy"
            decoding="async"
            style="display:block; width:100%; height:auto; border-radius:16px; box-shadow: 0 8px 24px rgba(0,0,0,.08);">
        </figure>
      {{- end -}}

      {{ with .Params.description }}
        <p class="lead">{{ . }}</p>
      {{ end }}
    </header>

    <section class="content">
      {{ .Content }}
    </section>

    <footer class="meta">
      {{ with .Lastmod }}
        <p class="small">Last updated: {{ .Format "2006-01-02" }}</p>
      {{ end }}
    </footer>
  </article>
</main>
{{ end }}
