{{- /* =========================================================
     Breadcrumbs (global)
     - Hidden on Home + taxonomy/term pages
     - Works for multilingual
     - Includes JSON-LD BreadcrumbList
     ========================================================= */ -}}

{{- if or .IsHome (in (slice "taxonomy" "term") .Kind) -}}
{{- else -}}
  {{- $lang := .Site.Language.Lang -}}
  {{- $labelHome := "Home" -}}
  {{- if eq $lang "de" -}}{{- $labelHome = "Startseite" -}}{{- end -}}
  {{- if eq $lang "fr" -}}{{- $labelHome = "Accueil" -}}{{- end -}}
  {{- if eq $lang "ru" -}}{{- $labelHome = "Главная" -}}{{- end -}}

  {{- $crumbs := slice -}}
  {{- $crumbs = $crumbs | append (dict "title" $labelHome "url" .Site.Home.RelPermalink) -}}

  {{- range .Ancestors.Reverse -}}
    {{- if and (ne .RelPermalink $.Site.Home.RelPermalink) (ne .Title "") -}}
      {{- $p := site.GetPage .RelPermalink -}}
      {{- if not $p -}}{{- $p = . -}}{{- end -}}

      {{- $t := $p.Title -}}
      {{- with $p.Params.breadcrumbTitle -}}
        {{- if ne . "" -}}{{- $t = . -}}{{- end -}}
      {{- end -}}

      {{- $crumbs = $crumbs | append (dict "title" $t "url" $p.RelPermalink) -}}
    {{- end -}}
  {{- end -}}

  {{- /* Current page crumb:
        - capacity leaf pages: "1TB"
        - model pages: use breadcrumbTitle if present (e.g., "T7")
        - else: .Title */ -}}
  {{- $currentTitle := .Title -}}
  {{- with .Params.capacity_label -}}
    {{- $currentTitle = . -}}
  {{- else -}}
    {{- with .Params.breadcrumbTitle -}}
      {{- if ne . "" -}}{{- $currentTitle = . -}}{{- end -}}
    {{- end -}}
  {{- end -}}
  {{- $crumbs = $crumbs | append (dict "title" $currentTitle "url" .RelPermalink) -}}

  <nav class="breadcrumbs" aria-label="Breadcrumb">
    <ol>
      {{- range $i, $c := $crumbs -}}
        <li>
          {{- if lt $i (sub (len $crumbs) 1) -}}
            <a href="{{ $c.url }}">{{ $c.title }}</a>
          {{- else -}}
            <span aria-current="page">{{ $c.title }}</span>
          {{- end -}}
        </li>
      {{- end -}}
    </ol>
  </nav>

  {{- $items := slice -}}
  {{- range $i, $c := $crumbs -}}
    {{- $items = $items | append (dict "@type" "ListItem" "position" (add $i 1) "name" $c.title "item" ($c.url | absURL)) -}}
  {{- end -}}
  <script type="application/ld+json">
  {{- dict "@context" "https://schema.org" "@type" "BreadcrumbList" "itemListElement" $items | jsonify -}}
  </script>
{{- end -}}